<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="description"
            content="Get started with Add-on development using JavaScript with Document Sandbox Runtime"
        />
        <meta name="keywords" content="Adobe, Express, Add-On, JavaScript, Document Sandbox Runtime" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="styles/styles.css" />
        <title>Get Started</title>
    </head>
    <body>
        <!-- 
            Please note that this document does not use the spectrum web components theme for Express.
            You may use "addOnUISdk.app.ui.theme" to get the current theme and style accordingly.
        -->
        <h1>QR Code Generator</h1>
        <div id="qrInputs">
            <label for="qrCodeURL">QR Code URL:</label>
            <input type="url" id="qrCodeURL" name="qrCodeURL" required/> <br><br>
            <label for="qrAesthetic">QR Code Aesthetic:</label>
            <input type="text" id="qrAesthetic" name="qrAesthetic" required/> <br><br>
            <button id="generateButton">Generate</button>
            <button id="resetButton">Reset</button>
        </div>
        
        <div id="result"></div>
        
        <script>
            async function generateResponse() {
                const url = document.getElementById('qrCodeURL').value;
                const aesthetic = document.getElementById('qrAesthetic').value;

                console.log('Sending request with:', { url, aesthetic });

                try {
                    const response = await fetch('http://localhost:5001/generate-qr', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            url: url,
                            aesthetic: aesthetic
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('Received response:', data);

                    // Strip out the backticks from the style string and parse the valid JSON
                    const styleString = data.style.replace(/^```json\n|\n```$/, ''); // Remove the code block formatting
                    const parsedStyle = JSON.parse(styleString);

                    document.getElementById('result').innerHTML = `
                        <h3>Generated QR Code Style:</h3>
                        <pre>${JSON.stringify(parsedStyle, null, 2)}</pre>
                    `;
                } catch (error) {
                    console.error('Detailed error:', error);
                    document.getElementById('result').innerHTML = `Error generating QR code style: ${error.message}`;
                }
            }

        
            document.getElementById('generateButton').addEventListener('click', function(event) {
                event.preventDefault(); // still good to have
                generateResponse();
            });
        
            document.getElementById('resetButton').addEventListener('click', function() {
                document.getElementById('qrCodeURL').value = '';
                document.getElementById('qrAesthetic').value = '';
                document.getElementById('result').innerHTML = '';
            });
        </script>
        
        <script type="module" src="ui/index.js"></script>
        
    </body>
</html>
